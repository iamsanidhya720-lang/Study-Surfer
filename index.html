<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Learn NEET Biology with Games</title>
    <!-- Google Fonts for better visual design -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Cormorant+Garamond:wght@300;400;600&family=Playfair+Display:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cormorant Garamond', serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            overflow: hidden;
            touch-action: manipulation;
            position: relative;
        }

        #landingPage::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(76, 175, 80, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 215, 0, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(100, 200, 255, 0.15) 0%, transparent 50%);
            animation: particleMove 20s ease-in-out infinite;
        }

        @keyframes particleMove {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(50px, -50px) scale(1.1); }
            66% { transform: translate(-50px, 50px) scale(0.9); }
        }

        #landingPage::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20% 30%, white, transparent),
                radial-gradient(2px 2px at 60% 70%, white, transparent),
                radial-gradient(1px 1px at 50% 50%, white, transparent),
                radial-gradient(1px 1px at 80% 10%, white, transparent),
                radial-gradient(2px 2px at 90% 60%, white, transparent);
            background-size: 200% 200%;
            animation: stars 30s ease-in-out infinite;
            opacity: 0.5;
        }

        @keyframes stars {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(-50px, -50px); }
        }

        #landingPage {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1), 
                        transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #landingPage.hidden {
            opacity: 0;
            transform: scale(0.95) translateY(-20px);
            pointer-events: none;
        }

        .landing-content {
            text-align: center;
            padding: 20px;
            max-width: 600px;
            position: relative;
            z-index: 2;
        }

        .landing-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(32px, 8vw, 64px);
            font-weight: bold;
            color: white;
            margin-bottom: 20px;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3),
                         0 0 40px rgba(255, 255, 255, 0.2);
            animation: floatIn 1s cubic-bezier(0.4, 0, 0.2, 1), 
                       titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), 0 0 40px rgba(255, 255, 255, 0.2); }
            50% { text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), 0 0 60px rgba(255, 255, 255, 0.4); }
        }

        .landing-subtitle {
            font-size: clamp(18px, 4vw, 28px);
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 40px;
            animation: floatIn 1s cubic-bezier(0.4, 0, 0.2, 1) 0.2s backwards;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        @keyframes floatIn {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #playButton {
            padding: 20px 60px;
            font-size: clamp(20px, 4vw, 28px);
            font-weight: bold;
            background: linear-gradient(135deg, #f39c12, #e74c3c);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3),
                        0 0 0 0 rgba(243, 156, 18, 0.4);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: floatIn 1s cubic-bezier(0.4, 0, 0.2, 1) 0.4s backwards, 
                       pulseGlow 2s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        #playButton::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        #playButton:hover::before {
            width: 300px;
            height: 300px;
        }

        #playButton span {
            position: relative;
            z-index: 1;
        }

        #playButton:hover {
            transform: scale(1.08) translateY(-3px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4),
                        0 0 30px rgba(243, 156, 18, 0.6);
        }

        #playButton:active {
            transform: scale(0.98) translateY(-1px);
            transition: all 0.1s;
        }

        @keyframes pulseGlow {
            0%, 100% { 
                box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3),
                            0 0 0 0 rgba(243, 156, 18, 0.4);
            }
            50% { 
                box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3),
                            0 0 0 15px rgba(243, 156, 18, 0);
            }
        }

        .landing-footer {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            animation: floatIn 1s cubic-bezier(0.4, 0, 0.2, 1) 0.6s backwards;
            padding: 0 20px;
            z-index: 2;
        }

        .social-link {
            color: white;
            text-decoration: none;
            font-size: clamp(14px, 3vw, 16px);
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .social-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .social-link:hover::before {
            left: 100%;
        }

        .social-link:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        #questionArea {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.98);
            padding: clamp(10px, 3vw, 20px) clamp(15px, 4vw, 30px);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3),
                        0 0 0 1px rgba(255, 255, 255, 0.5) inset;
            z-index: 100;
            max-width: 95%;
            text-align: center;
            animation: slideDown 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        #question {
            font-size: clamp(16px, 4vw, 24px);
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        #timer {
            font-size: clamp(14px, 3vw, 18px);
            color: #e74c3c;
            font-weight: bold;
            transition: all 0.3s;
        }

        #timer.warning {
            animation: timerPulse 0.5s ease infinite;
            color: #c0392b;
        }

        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        #scoreBoard {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.98);
            padding: clamp(10px, 3vw, 15px) clamp(15px, 4vw, 25px);
            border-radius: 15px;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2),
                        0 0 0 1px rgba(255, 255, 255, 0.5) inset;
            z-index: 100;
            animation: slideLeft 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        @keyframes slideLeft {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        #score {
            font-size: clamp(16px, 3vw, 20px);
            font-weight: bold;
            color: #27ae60;
            transition: all 0.3s;
        }

        #score.pulse {
            animation: scorePulse 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes scorePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); color: #2ecc71; }
        }

        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            background: linear-gradient(180deg, #a8edea 0%, #fed6e3 100%);
        }

        #feedback {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 200;
            display: none;
        }

        .confetti {
            position: absolute;
            font-size: clamp(20px, 5vw, 40px);
            animation: confettiFall 3s ease-out forwards;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.8));
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(0) rotate(0deg) scale(0);
                opacity: 1;
            }
            10% {
                transform: translateY(10vh) rotate(36deg) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg) scale(0.8);
                opacity: 0;
            }
        }

        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: rgba(255, 255, 255, 0.98);
            padding: clamp(20px, 5vw, 40px) clamp(30px, 7vw, 60px);
            border-radius: 25px;
            box-shadow: 0 15px 60px rgba(0, 0, 0, 0.4),
                        0 0 0 2px rgba(255, 255, 255, 0.5) inset;
            text-align: center;
            display: none;
            z-index: 300;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            opacity: 0;
            animation: gameOverAppear 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        #gameOver.show {
            display: block;
        }

        @keyframes gameOverAppear {
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        #gameOver h2 {
            font-size: clamp(24px, 6vw, 36px);
            color: #333;
            margin-bottom: 20px;
            animation: fadeIn 0.8s ease 0.3s backwards;
        }

        #finalScore {
            font-size: clamp(20px, 5vw, 28px);
            color: #27ae60;
            margin-bottom: 30px;
            animation: fadeIn 0.8s ease 0.5s backwards;
        }

        #restartBtn {
            padding: clamp(10px, 3vw, 15px) clamp(20px, 5vw, 40px);
            font-size: clamp(16px, 4vw, 20px);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeIn 0.8s ease 0.7s backwards;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        #restartBtn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        #restartBtn:hover::before {
            width: 300px;
            height: 300px;
        }

        #restartBtn:hover {
            transform: scale(1.08) translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        #restartBtn:active {
            transform: scale(0.98);
        }

        .report-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 25px 0;
            animation: fadeIn 0.8s ease 0.9s backwards;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            border-radius: 15px;
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.correct {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .stat-card.incorrect {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }

        .stat-card.skipped {
            background: linear-gradient(135deg, #757f9a 0%, #d7dde8 100%);
        }

        .stat-value {
            font-size: clamp(28px, 6vw, 36px);
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: clamp(12px, 3vw, 14px);
            opacity: 0.9;
        }

        .report-details {
            text-align: left;
            margin-top: 30px;
            max-height: 400px;
            overflow-y: auto;
            animation: fadeIn 0.8s ease 1.1s backwards;
            padding: 10px;
        }

        .report-details::-webkit-scrollbar {
            width: 8px;
        }

        .report-details::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        .report-details::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }

        .report-title {
            font-size: clamp(18px, 4vw, 22px);
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .question-review {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: all 0.3s;
        }

        .question-review:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transform: translateX(5px);
        }

        .question-review.correct {
            border-left-color: #38ef7d;
            background: linear-gradient(90deg, rgba(56, 239, 125, 0.1) 0%, #f8f9fa 100%);
        }

        .question-review.incorrect {
            border-left-color: #f45c43;
            background: linear-gradient(90deg, rgba(244, 92, 67, 0.1) 0%, #f8f9fa 100%);
        }

        .question-review.skipped {
            border-left-color: #95a5a6;
            background: linear-gradient(90deg, rgba(149, 165, 166, 0.1) 0%, #f8f9fa 100%);
        }

        .question-number {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
            font-size: clamp(14px, 3vw, 16px);
        }

        .question-text {
            font-size: clamp(14px, 3vw, 16px);
            color: #333;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .answer-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 5px 0;
            font-size: clamp(12px, 3vw, 14px);
        }

        .answer-label {
            font-weight: bold;
            min-width: 100px;
        }

        .answer-value {
            color: #555;
        }

        .answer-value.correct-ans {
            color: #27ae60;
            font-weight: bold;
        }

        .answer-value.wrong-ans {
            color: #e74c3c;
            font-weight: bold;
        }

        .answer-value.skipped-ans {
            color: #95a5a6;
            font-style: italic;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: clamp(11px, 2.5vw, 13px);
            font-weight: bold;
            margin-top: 8px;
        }

        .status-badge.correct {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.incorrect {
            background: #f8d7da;
            color: #721c24;
        }

        .status-badge.skipped {
            background: #e2e3e5;
            color: #383d41;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
            animation: fadeIn 0.8s ease 1.3s backwards;
        }

        .btn-secondary {
            padding: clamp(10px, 3vw, 15px) clamp(20px, 5vw, 40px);
            font-size: clamp(16px, 4vw, 20px);
            background: linear-gradient(135deg, #f39c12, #e74c3c);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .btn-secondary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-secondary:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-secondary:hover {
            transform: scale(1.08) translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        .btn-secondary:active {
            transform: scale(0.98);
        }

        #progressBar {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            height: clamp(15px, 3vw, 20px);
            background: rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            overflow: hidden;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1) inset,
                        0 2px 5px rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(5px);
        }

        #progress {
            height: 100%;
            background: linear-gradient(90deg, #f39c12, #e74c3c, #f39c12);
            background-size: 200% 100%;
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            animation: progressShine 2s linear infinite;
            box-shadow: 0 0 15px rgba(243, 156, 18, 0.5);
        }

        @keyframes progressShine {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        @media (max-width: 768px) {
            .landing-footer {
                bottom: 10px;
                gap: 10px;
            }
            
            .social-link {
                font-size: 12px;
                padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <div id="landingPage">
        <div class="landing-content">
            <h1 class="landing-title">ðŸ§¬ Learn NEET Biology with Games! ðŸŽ®</h1>
            <p class="landing-subtitle">Master biology concepts through fun and interactive gameplay</p>
            <button id="playButton"><span>ðŸš€ Let's Play!</span></button>
        </div>

        <div class="landing-footer">
            <a href="https://www.instagram.com/iamsanidhya" target="_blank" class="social-link">ðŸ“· Instagram</a>
            <a href="https://www.linkedin.com/in/iamsanidhya" target="_blank" class="social-link">ðŸ’¼ LinkedIn</a>
            <a href="https://github.com/iamsanidhya" target="_blank" class="social-link">ðŸ’» GitHub</a>
            <a href="mailto:iamsanidhya.720@gmail.com" class="social-link">ðŸ“§ Email</a>
        </div>
    </div>

    <div id="gameContainer">
        <div id="questionArea">
            <div id="question">Get Ready!</div>
            <!-- Timer text updated to reflect 10 seconds -->
            <div id="timer">Time: 12s</div>
        </div>
        
        <div id="scoreBoard">
            <div id="score">Score: 0</div>
        </div>

        <canvas id="gameCanvas"></canvas>

        <div id="feedback"></div>

        <div id="gameOver">
            <h2>ðŸŽ“ Report Card</h2>
            <div id="finalScore"></div>
            <div class="report-summary" id="reportSummary"></div>
            <div class="report-details" id="reportDetails"></div>
            <div class="button-group">
                <button id="restartBtn">ðŸ”„ Play Again</button>
                <button id="shareBtn" class="btn-secondary">ðŸ“¤ Share Results</button>
            </div>
        </div>

        <div id="progressBar">
            <div id="progress"></div>
        </div>
    </div>

    <script>
        // NOTE: For full functionality, ensure 'correct.mp3', 'wrong.mp3', and 'background.mp3' are in the same directory.
        const sounds = {
            correct: new Audio('correct.mp3'),
            wrong: new Audio('wrong.mp3'),
            background: new Audio('background.mp3')
        };

        sounds.background.loop = true;
        sounds.background.volume = 0.3;

        // --- ENHANCED NEET BIOLOGY QUESTION DATASET (40 QUESTIONS) ---
        const questions = [
            {
                question: "The functional unit of inheritance is:",
                options: ["Chromosome", "Gene", "Allele"],
                correct: 1
            },
            {
                question: "Which organelle is called the 'powerhouse of the cell'?",
                options: ["Ribosome", "Mitochondria", "Nucleus"],
                correct: 1
            },
            {
                question: "The process of glycolysis occurs in the:",
                options: ["Mitochondria", "Cytoplasm", "Nucleus"],
                correct: 1
            },
            {
                question: "Which blood component helps in coagulation?",
                options: ["RBCs", "WBCs", "Platelets"],
                correct: 2
            },
            {
                question: "The total number of bones in the human body is:",
                options: ["206", "210", "208"],
                correct: 0
            },
            {
                question: "Which of the following is an example of a vestigial organ in humans?",
                options: ["Kidney", "Appendix", "Liver"],
                correct: 1
            },
            {
                question: "The universally accepted blood donor group is:",
                options: ["A", "B", "O"],
                correct: 2
            },
            {
                question: "Photosynthesis occurs primarily in which part of the plant?",
                options: ["Root", "Stem", "Leaf"],
                correct: 2
            },
            {
                question: "In DNA, Adenine pairs with:",
                options: ["Cytosine", "Thymine", "Guanine"],
                correct: 1
            },
            {
                question: "Which hormone is known as the stress hormone?",
                options: ["Insulin", "Adrenaline", "Thyroxine"],
                correct: 1
            },
            {
                question: "The cell wall of fungi is composed of:",
                options: ["Cellulose", "Chitin", "Pectin"],
                correct: 1
            },
            {
                question: "Erythroblastosis fetalis is caused by incompatibility in:",
                options: ["ABO group", "Rh factor", "Both"],
                correct: 1
            },
            {
                question: "Which element is essential for the formation of chlorophyll?",
                options: ["Calcium", "Magnesium", "Iron"],
                correct: 1
            },
            {
                question: "The process of nitrogen fixation is carried out by:",
                options: ["Fungi", "Bacteria", "Algae"],
                correct: 1
            },
            {
                question: "What is the primary function of lysosomes?",
                options: ["Protein synthesis", "Intracellular digestion", "Energy production"],
                correct: 1
            },
            {
                question: "The phenomenon where a single gene exhibits multiple phenotypic expressions is called:",
                options: ["Epistasis", "Pleiotropy", "Polygenic inheritance"],
                correct: 1
            },
            {
                question: "Which layer of the atmosphere is closest to Earth?",
                options: ["Stratosphere", "Troposphere", "Mesosphere"],
                correct: 1
            },
            {
                question: "The term 'double fertilization' is characteristic of:",
                options: ["Algae", "Gymnosperms", "Angiosperms"],
                correct: 2
            },
            {
                question: "The pacemaker of the heart is:",
                options: ["AV node", "Bundle of His", "SA node"],
                correct: 2
            },
            {
                question: "Mendel's Law of Independent Assortment is not applicable to:",
                options: ["Linked genes", "Non-linked genes", "Hereditary traits"],
                correct: 0
            },
            {
                question: "The enzyme responsible for converting starch to maltose is:",
                options: ["Lipase", "Amylase", "Protease"],
                correct: 1
            },
            {
                question: "Which kingdom includes organisms that are unicellular, eukaryotic, and photosynthetic?",
                options: ["Monera", "Protista", "Fungi"],
                correct: 1
            },
            {
                question: "The main function of the Kidney is:",
                options: ["Digestion", "Excretion", "Respiration"],
                correct: 1
            },
            {
                question: "In which phase of the cell cycle does DNA replication occur?",
                options: ["G1 phase", "S phase", "G2 phase"],
                correct: 1
            },
            {
                question: "The major constituent of semen is:",
                options: ["Sperm", "Prostatic fluid", "Fructose"],
                correct: 2
            },
            {
                question: "Which type of immunity is obtained after a vaccination?",
                options: ["Passive natural", "Active artificial", "Passive artificial"],
                correct: 1
            },
            {
                question: "The primary source of energy for an ecosystem is:",
                options: ["Water", "Sunlight", "Minerals"],
                correct: 1
            },
            {
                question: "Mycorrhiza is an example of:",
                options: ["Parasitism", "Mutualism", "Commensalism"],
                correct: 1
            },
            {
                question: "The movement of water through the cell wall is called:",
                options: ["Apoplast pathway", "Symplast pathway", "Translocation"],
                correct: 0
            },
            {
                question: "Which phylum includes animals with a water vascular system?",
                options: ["Mollusca", "Arthropoda", "Echinodermata"],
                correct: 2
            },
            {
                question: "The conversion of amino acids into glucose is termed:",
                options: ["Glycolysis", "Gluconeogenesis", "Glycogenesis"],
                correct: 1
            },
            {
                question: "The universal recipient blood group is:",
                options: ["A", "B", "AB"],
                correct: 2
            },
            {
                question: "Diatoms are also known as:",
                options: ["Chief producers of the seas", "Red tides", "Fungus threads"],
                correct: 0
            },
            {
                question: "Who is known as the Father of Genetics?",
                options: ["Charles Darwin", "Gregor Mendel", "Lamarck"],
                correct: 1
            },
            {
                question: "Which part of the brain is responsible for balance and posture?",
                options: ["Cerebrum", "Cerebellum", "Medulla"],
                correct: 1
            },
            {
                question: "Photolysis of water occurs during:",
                options: ["Light reaction", "Dark reaction", "Respiration"],
                correct: 0
            },
            {
                question: "The secondary lymphoid organ is:",
                options: ["Thymus", "Bone marrow", "Spleen"],
                correct: 2
            },
            {
                question: "The process of uptake of naked DNA from the medium is called:",
                options: ["Transduction", "Transformation", "Conjugation"],
                correct: 1
            },
            {
                question: "Which of the following is a greenhouse gas?",
                options: ["Oxygen", "Nitrogen", "Methane"],
                correct: 2
            },
            {
                question: "The breakdown of glucose into pyruvic acid is called:",
                options: ["Kreb's Cycle", "Glycolysis", "ETS"],
                correct: 1
            }
        ];

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameState = {
            currentQuestion: 0,
            score: 0,
            // Retaining the requested slower speed
            speed: 1, 
            // Retaining the requested 10 seconds timer
            timerValue: 12,
            gameRunning: false,
            cameraY: 0,
            hasAnswered: false
        };

        let answerHistory = [];

        const player = {
            lane: 1,
            targetLane: 1,
            x: 0,
            y: 400,
            width: 40,
            height: 60,
            color: '#e74c3c'
        };

        let answerBlocks = [];
        let backgroundObjects = [];
        let timer = null;
        let touchStartX = 0;
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (gameState.gameRunning) {
                // Ensure player doesn't fall off screen after resize
                player.y = Math.min(player.y, canvas.height - 150);
            }
        }
        
        resizeCanvas();

        document.getElementById('playButton').addEventListener('click', function() {
            document.getElementById('landingPage').classList.add('hidden');
            setTimeout(function() {
                sounds.background.play().catch(function(e) {});
                initGame();
            }, 800);
        });

        function initGame() {
            gameState = {
                currentQuestion: 0,
                score: 0,
                speed: 1.5, // Match initial speed
                timerValue: 12, // Match initial timer
                gameRunning: true,
                cameraY: 0,
                hasAnswered: false
            };
            answerHistory = [];
            player.lane = 1;
            player.targetLane = 1;
            // Set player initial Y position to be relative to the bottom of the screen
            player.y = canvas.height - 150; 
            answerBlocks = [];
            backgroundObjects = [];
            
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('gameOver').classList.remove('show');
            updateScore();
            loadQuestion();
            startTimer();
            createBackgroundObjects();
            gameLoop();
        }

        function loadQuestion() {
            if (gameState.currentQuestion >= questions.length) {
                endGame();
                return;
            }

            const q = questions[gameState.currentQuestion];
            const questionEl = document.getElementById('question');
            questionEl.style.animation = 'none';
            setTimeout(function() {
                questionEl.textContent = q.question;
                questionEl.style.animation = 'fadeIn 0.5s ease';
            }, 10);
            
            answerBlocks = [];
            const blockWidth = canvas.width / 3;
            
            // INCREASED DISTANCE: Changing from -400 to -600 world units.
            // This gives the player more time to read the question before the blocks appear.
            const blockYStart = gameState.cameraY - 600; 
            
            for (let i = 0; i < 3; i++) {
                answerBlocks.push({
                    lane: i,
                    x: i * blockWidth,
                    y: blockYStart, // World Y position
                    width: blockWidth - 20,
                    height: 100,
                    text: q.options[i],
                    isCorrect: i === q.correct,
                    color: ['#3498db', '#9b59b6', '#e67e22'][i],
                    passed: false,
                    scale: 1
                });
            }

            // Set the timer value for the new question
            gameState.timerValue = 12;
            gameState.hasAnswered = false;
            updateProgress();
        }

        function createBackgroundObjects() {
            // Clear existing objects
            backgroundObjects = []; 
            for (let i = 0; i < 20; i++) {
                backgroundObjects.push({
                    // Ensure objects are generated far behind or in front of the current camera view
                    x: Math.random() < 0.5 ? -30 : canvas.width + 10,
                    y: gameState.cameraY - i * (canvas.height / 2),
                    type: Math.random() > 0.5 ? 'tree' : 'rock'
                });
            }
        }

        function startTimer() {
            clearInterval(timer);
            const timerEl = document.getElementById('timer');
            timerEl.classList.remove('warning');
            
            timerEl.textContent = 'Time: ' + gameState.timerValue + 's'; // Initial timer update

            timer = setInterval(function() {
                if (!gameState.gameRunning) return;
                
                gameState.timerValue--;
                timerEl.textContent = 'Time: ' + gameState.timerValue + 's';
                
                if (gameState.timerValue <= 5) {
                    timerEl.classList.add('warning');
                }
                
                if (gameState.timerValue <= 0 && !gameState.hasAnswered) {
                    gameState.hasAnswered = true;
                    
                    const q = questions[gameState.currentQuestion];
                    answerHistory.push({
                        question: q.question,
                        options: q.options,
                        correctAnswer: q.options[q.correct],
                        userAnswer: null,
                        isCorrect: false,
                        isSkipped: true
                    });
                    
                    createSadConfetti();
                    sounds.wrong.play().catch(function(e) {});
                    setTimeout(function() {
                        nextQuestion();
                    }, 1000);
                }
            }, 1000);
        }

        function checkAnswer() {
            if (gameState.hasAnswered) return;

            for (let i = 0; i < answerBlocks.length; i++) {
                const block = answerBlocks[i];
                // Calculate the block's current screen Y position
                const blockScreenY = block.y - gameState.cameraY + player.y; 
                
                // Check if the player is aligned with the block's Y position
                if (blockScreenY >= player.y - player.height / 2 && 
                    blockScreenY <= player.y + player.height / 2 && 
                    block.lane === player.lane && 
                    !block.passed) {
                    
                    block.passed = true;
                    gameState.hasAnswered = true;

                    const q = questions[gameState.currentQuestion];
                    
                    answerHistory.push({
                        question: q.question,
                        options: q.options,
                        correctAnswer: q.options[q.correct],
                        userAnswer: block.text,
                        isCorrect: block.isCorrect,
                        isSkipped: false
                    });

                    if (block.isCorrect) {
                        gameState.score += 10;
                        gameState.speed += 0.3;
                        updateScore(true);
                        createConfetti();
                        sounds.correct.play().catch(function(e) {});
                        
                        // Wait for a celebratory moment before moving to the next question
                        setTimeout(function() {
                            nextQuestion();
                        }, 2000); 
                    } else {
                        createSadConfetti();
                        sounds.wrong.play().catch(function(e) {});
                        
                        // Wait a moment after wrong answer before moving on
                        setTimeout(function() {
                            nextQuestion();
                        }, 1000);
                    }
                    break;
                }
            }
        }

        function nextQuestion() {
            gameState.currentQuestion++;
            loadQuestion();
            startTimer();
        }

        function createConfetti() {
            const emojis = ['ðŸŽ‰', 'ðŸŽŠ', 'âœ¨', 'â­', 'ðŸŒŸ', 'ðŸ’«', 'ðŸŽˆ', 'ðŸ†', 'ðŸ’¯'];
            const feedbackContainer = document.getElementById('feedback');
            feedbackContainer.style.display = 'block';
            feedbackContainer.innerHTML = '';

            for (let i = 0; i < 60; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '-50px';
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                
                feedbackContainer.appendChild(confetti);
            }

            setTimeout(function() {
                feedbackContainer.style.display = 'none';
                feedbackContainer.innerHTML = '';
            }, 4000);
        }

        function createSadConfetti() {
            const sadEmojis = ['ðŸ˜¢', 'ðŸ˜­', 'ðŸ˜ž', 'ðŸ˜”', 'ðŸ’”', 'ðŸ˜¿', 'ðŸ’¨'];
            const feedbackContainer = document.getElementById('feedback');
            feedbackContainer.style.display = 'block';
            feedbackContainer.innerHTML = '';

            for (let i = 0; i < 40; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.textContent = sadEmojis[Math.floor(Math.random() * sadEmojis.length)];
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '-50px';
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                
                feedbackContainer.appendChild(confetti);
            }

            setTimeout(function() {
                feedbackContainer.style.display = 'none';
                feedbackContainer.innerHTML = '';
            }, 3000);
        }

        function updateScore(animate) {
            const scoreEl = document.getElementById('score');
            scoreEl.textContent = 'Score: ' + gameState.score;
            
            if (animate) {
                scoreEl.classList.remove('pulse');
                setTimeout(function() {
                    scoreEl.classList.add('pulse');
                }, 10);
                setTimeout(function() {
                    scoreEl.classList.remove('pulse');
                }, 500);
            }
        }

        function updateProgress() {
            const progress = ((gameState.currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }

        function endGame() {
            gameState.gameRunning = false;
            clearInterval(timer);
            sounds.background.pause();
            
            const totalQuestions = answerHistory.length;
            const correctAnswers = answerHistory.filter(function(a) { return a.isCorrect; }).length;
            const incorrectAnswers = answerHistory.filter(function(a) { return !a.isCorrect && !a.isSkipped; }).length;
            const skippedQuestions = answerHistory.filter(function(a) { return a.isSkipped; }).length;
            const percentage = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
            
            document.getElementById('finalScore').innerHTML = 
                '<div style="font-size: clamp(32px, 7vw, 48px); color: #667eea; font-weight: bold; margin-bottom: 10px;">' +
                percentage + '%</div>' +
                '<div style="font-size: clamp(16px, 4vw, 20px); color: #555;">' +
                gameState.score + ' / ' + (questions.length * 10) + ' Points</div>';
            
            const summaryHTML = 
                '<div class="stat-card correct"><div class="stat-value">âœ“ ' + correctAnswers + '</div><div class="stat-label">Correct</div></div>' +
                '<div class="stat-card incorrect"><div class="stat-value">âœ— ' + incorrectAnswers + '</div><div class="stat-label">Incorrect</div></div>' +
                '<div class="stat-card skipped"><div class="stat-value">âŠ˜ ' + skippedQuestions + '</div><div class="stat-label">Skipped</div></div>' +
                '<div class="stat-card"><div class="stat-value">' + totalQuestions + '</div><div class="stat-label">Total</div></div>';
            document.getElementById('reportSummary').innerHTML = summaryHTML;
            
            let detailsHTML = '<div class="report-title">ðŸ“‹ Question Review</div>';
            for (let i = 0; i < answerHistory.length; i++) {
                const item = answerHistory[i];
                const statusClass = item.isSkipped ? 'skipped' : (item.isCorrect ? 'correct' : 'incorrect');
                const statusText = item.isSkipped ? 'Skipped' : (item.isCorrect ? 'Correct' : 'Incorrect');
                const statusIcon = item.isSkipped ? 'âŠ˜' : (item.isCorrect ? 'âœ“' : 'âœ—');
                
                detailsHTML += '<div class="question-review ' + statusClass + '">' +
                    '<div class="question-number">Question ' + (i + 1) + '</div>' +
                    '<div class="question-text">' + item.question + '</div>' +
                    '<div class="answer-row">' +
                    '<span class="answer-label">Your Answer:</span>' +
                    '<span class="answer-value ' + (item.isSkipped ? 'skipped-ans' : (item.isCorrect ? 'correct-ans' : 'wrong-ans')) + '">' +
                    (item.userAnswer || 'Not Answered') + '</span></div>';
                
                if (!item.isCorrect) {
                    detailsHTML += '<div class="answer-row">' +
                        '<span class="answer-label">Correct Answer:</span>' +
                        '<span class="answer-value correct-ans">' + item.correctAnswer + '</span></div>';
                }
                
                detailsHTML += '<span class="status-badge ' + statusClass + '">' + statusIcon + ' ' + statusText + '</span></div>';
            }
            document.getElementById('reportDetails').innerHTML = detailsHTML;
            
            const gameOverEl = document.getElementById('gameOver');
            gameOverEl.style.display = 'block';
            setTimeout(function() {
                gameOverEl.classList.add('show');
            }, 10);
        }

        function drawRoad() {
            if (!gameState.hasAnswered) {
                // Camera moves backwards in world coordinates, creating the illusion of forward motion.
                gameState.cameraY -= gameState.speed;
            }

            const laneWidth = canvas.width / 3;
            
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 3;
            ctx.setLineDash([20, 15]);
            ctx.shadowBlur = 5;
            ctx.shadowColor = 'rgba(255, 255, 255, 0.3)';
            
            // Draw lane dividers
            for (let i = 1; i < 3; i++) {
                ctx.beginPath();
                ctx.moveTo(i * laneWidth, 0);
                ctx.lineTo(i * laneWidth, canvas.height);
                ctx.stroke();
            }
            
            ctx.setLineDash([]);
            ctx.shadowBlur = 0;
            
            // Draw center dashes (visual effect)
            const dashHeight = 50;
            const dashGap = 100;
            const totalDashArea = dashHeight + dashGap;
            const startY = gameState.cameraY % totalDashArea; // Corrected to use cameraY for scrolling effect

            for (let i = 0; i * totalDashArea - startY < canvas.height; i++) {
                const y = i * totalDashArea - startY;
                if (y < -dashHeight) continue;

                ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.shadowBlur = 10;
                ctx.shadowColor = 'rgba(255, 255, 255, 0.5)';
                
                // Dash 1
                ctx.fillRect(laneWidth / 2 - 5, y, 10, dashHeight); 
                // Dash 2
                ctx.fillRect(laneWidth + laneWidth / 2 - 5, y, 10, dashHeight);
                ctx.shadowBlur = 0;
            }
        }

        function drawBackgroundObjects() {
            // Remove old objects and add new ones if needed
            backgroundObjects = backgroundObjects.filter(obj => (obj.y - gameState.cameraY + player.y) < canvas.height + 100);

            // Add new objects when old ones are removed
            while (backgroundObjects.length < 20) {
                 backgroundObjects.push({
                    x: Math.random() < 0.5 ? -30 : canvas.width + 10,
                    // Place new object far in front of the camera (negative world Y)
                    y: Math.min(...backgroundObjects.map(o => o.y), gameState.cameraY) - (canvas.height / 2) * Math.random(), 
                    type: Math.random() > 0.5 ? 'tree' : 'rock'
                });
            }

            for (let i = 0; i < backgroundObjects.length; i++) {
                const obj = backgroundObjects[i];
                // Calculate screen position relative to the camera and player
                const screenY = obj.y - gameState.cameraY + player.y;
                
                if (screenY < -100 || screenY > canvas.height + 100) continue;

                if (obj.type === 'tree') {
                    ctx.shadowBlur = 8;
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                    ctx.fillStyle = '#8b4513';
                    ctx.fillRect(obj.x, screenY, 20, 40);
                    ctx.fillStyle = '#2ecc71';
                    ctx.beginPath();
                    ctx.arc(obj.x + 10, screenY - 10, 25, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    ctx.shadowBlur = 5;
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
                    ctx.fillStyle = '#7f8c8d';
                    ctx.beginPath();
                    ctx.arc(obj.x, screenY, 15, 0, Math.PI * 2);
                    ctx.fill();
                }
                ctx.shadowBlur = 0;
            }
        }

        function drawPlayer() {
            const laneWidth = canvas.width / 3;
            const targetX = player.targetLane * laneWidth + laneWidth / 2;
            
            const smoothing = 0.15;
            if (Math.abs(player.x - targetX) > 1) {
                const diff = targetX - player.x;
                player.x += diff * smoothing;
            } else {
                player.x = targetX;
                player.lane = player.targetLane;
            }

            ctx.shadowBlur = 15;
            ctx.shadowColor = 'rgba(231, 76, 60, 0.6)';
            ctx.fillStyle = player.color;
            
            ctx.fillRect(player.x - player.width / 2, player.y, player.width, player.height);
            
            ctx.beginPath();
            ctx.arc(player.x, player.y - 10, 20, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.shadowBlur = 0;
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(player.x - 7, player.y - 12, 5, 0, Math.PI * 2);
            ctx.arc(player.x + 7, player.y - 12, 5, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(player.x - 7, player.y - 12, 2, 0, Math.PI * 2);
            ctx.arc(player.x + 7, player.y - 12, 2, 0, Math.PI * 2);
            ctx.fill();

            const legOffset = Math.sin(Date.now() / 100) * 5;
            ctx.shadowBlur = 10;
            ctx.shadowColor = 'rgba(231, 76, 60, 0.4)';
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x - 12, player.y + player.height, 8, 20 + legOffset);
            ctx.fillRect(player.x + 4, player.y + player.height, 8, 20 - legOffset);
            ctx.shadowBlur = 0;
        }

        function drawAnswerBlocks() {
            for (let i = 0; i < answerBlocks.length; i++) {
                const block = answerBlocks[i];
                
                // Calculate screen Y correctly relative to camera and player position
                const screenY = block.y - gameState.cameraY + player.y; 
                
                if (screenY < -200 || screenY > canvas.height + 200) continue;
                
                // Scale the block up as it gets closer to the player
                const distanceToPlayer = Math.abs(screenY - player.y);
                if (distanceToPlayer < 400 && block.lane === player.lane && !block.passed) {
                    // Maximum scale of 1.2 when very close (400px distance)
                    block.scale = 1 + (400 - distanceToPlayer) / 2000; 
                } else {
                    block.scale = 1;
                }

                ctx.save();
                ctx.translate(block.x + block.width / 2 + 10, screenY + block.height / 2);
                ctx.scale(block.scale, block.scale);
                ctx.translate(-(block.x + block.width / 2 + 10), -(screenY + block.height / 2));

                const gradient = ctx.createLinearGradient(
                    block.x + 10, screenY,
                    block.x + 10, screenY + block.height
                );
                gradient.addColorStop(0, block.color);
                gradient.addColorStop(1, shadeColor(block.color, -20));
                
                ctx.shadowBlur = 20;
                ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                ctx.fillStyle = gradient;
                
                roundRect(ctx, block.x + 10, screenY, block.width, block.height, 15);
                ctx.fill();
                
                ctx.shadowBlur = 0;
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 3;
                roundRect(ctx, block.x + 10, screenY, block.width, block.height, 15);
                ctx.stroke();
                
                // Draw Text with wrapping and vertical centering
                ctx.fillStyle = '#fff';
                ctx.textAlign = 'center';
                ctx.shadowBlur = 3;
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                
                const maxTextWidth = block.width - 20;
                const fontSize = Math.min(20, Math.max(14, canvas.width / 40));
                ctx.font = 'bold ' + fontSize + 'px Arial';
                
                wrapText(ctx, block.text, block.x + block.width / 2 + 10, screenY + 15, maxTextWidth, fontSize + 5, block.height);
                
                ctx.shadowBlur = 0;

                ctx.restore();

                checkAnswer();
            }
        }
        
        // Function to wrap text inside the answer blocks and center it vertically
        function wrapText(context, text, x, y, maxWidth, lineHeight, blockHeight) {
            const words = text.split(' ');
            let line = '';
            const lines = [];

            for(let n = 0; n < words.length; n++) {
                const testLine = line + words[n] + ' ';
                const metrics = context.measureText(testLine);
                const testWidth = metrics.width;
                if (testWidth > maxWidth && n > 0) {
                    lines.push(line.trim());
                    line = words[n] + ' ';
                } else {
                    line = testLine;
                }
            }
            lines.push(line.trim());
            
            // Calculate starting Y position for vertical centering
            let startY = y + (blockHeight / 2) - (lines.length / 2) * lineHeight;

            for(let i = 0; i < lines.length; i++) {
                context.fillText(lines[i], x, startY + i * lineHeight);
            }
        }


        // Helper function for rounded rectangles
        function roundRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
        }

        // Helper function to slightly darken a color for gradient
        function shadeColor(color, percent) {
            const num = parseInt(color.replace("#",""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 +
                (G<255?G<1?0:G:255)*0x100 + (B<255?B<1?0:B:255))
                .toString(16).slice(1);
        }

        function gameLoop() {
            if (!gameState.gameRunning) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            drawRoad();
            drawBackgroundObjects();
            drawAnswerBlocks();
            drawPlayer();

            requestAnimationFrame(gameLoop);
        }

        // --- INPUT HANDLERS ---
        document.addEventListener('keydown', function(e) {
            if (!gameState.gameRunning) return;
            
            if (e.key === 'ArrowLeft' && player.targetLane > 0) {
                player.targetLane--;
                e.preventDefault();
            } else if (e.key === 'ArrowRight' && player.targetLane < 2) {
                player.targetLane++;
                e.preventDefault();
            }
        });

        canvas.addEventListener('touchstart', function(e) {
            touchStartX = e.touches[0].clientX;
            e.preventDefault();
        });

        canvas.addEventListener('touchend', function(e) {
            if (!gameState.gameRunning) return;
            
            const touchEndX = e.changedTouches[0].clientX;
            const diff = touchEndX - touchStartX;
            
            // Swipe right
            if (diff > 50 && player.targetLane < 2) {
                player.targetLane++;
            // Swipe left
            } else if (diff < -50 && player.targetLane > 0) {
                player.targetLane--;
            } else {
                // Handle tap for lane change
                const rect = canvas.getBoundingClientRect();
                const clickX = e.changedTouches[0].clientX - rect.left;
                const laneWidth = canvas.width / 3;
                const clickedLane = Math.floor(clickX / laneWidth);
                
                // If the player taps in a different lane, switch to it
                if (clickedLane !== player.lane) {
                    player.targetLane = Math.max(0, Math.min(2, clickedLane));
                }
            }
            e.preventDefault();
        });

        // Click/Mouse input for desktop
        canvas.addEventListener('mousedown', function(e) {
            if (!gameState.gameRunning) return;
            
            const rect = canvas.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const laneWidth = canvas.width / 3;
            const clickedLane = Math.floor(clickX / laneWidth);
            player.targetLane = Math.max(0, Math.min(2, clickedLane));
            e.preventDefault();
        });

        document.getElementById('restartBtn').addEventListener('click', function() {
            sounds.background.currentTime = 0;
            sounds.background.play().catch(function(e) {});
            initGame();
        });

        document.getElementById('shareBtn').addEventListener('click', function() {
            const totalQuestions = answerHistory.length;
            const correctAnswers = answerHistory.filter(function(a) { return a.isCorrect; }).length;
            const percentage = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
            
            const shareText = 'ðŸŽ“ I just completed NEET Biology Game!\n\nðŸ“Š My Results:\nâœ“ Correct: ' + correctAnswers + '/' + totalQuestions + '\nðŸ“ˆ Score: ' + percentage + '%\nðŸ† Points: ' + gameState.score + '/' + (questions.length * 10) + '\n\nCan you beat my score? ðŸŽ®';
            
            if (navigator.share) {
                navigator.share({
                    title: 'My NEET Biology Game Results',
                    text: shareText
                }).catch(function(e) {});
            } else {
                navigator.clipboard.writeText(shareText).then(function() {
                    // Replaced alert() with console logging as per instructions
                    console.log('Results copied to clipboard! Share it with your friends!');
                }).catch(function() {
                    console.log('Clipboard copy failed. Manually copy: \n' + shareText);
                });
            }
        });

        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('orientationchange', function() {
            setTimeout(resizeCanvas, 100);
        });
    </script>
</body>
</html>
